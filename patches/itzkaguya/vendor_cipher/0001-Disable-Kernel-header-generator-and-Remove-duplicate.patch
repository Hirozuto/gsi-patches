From f1e3604546b307790ce8a01bbec03aec110b3aa9 Mon Sep 17 00:00:00 2001
From: Raka Prasetya Pratama <madeayurenapramudya@gmail.com>
Date: Tue, 14 Mar 2023 10:48:08 +0000
Subject: [PATCH] Disable Kernel header generator and Remove duplicated
 ro.adb.secure

---
 build/soong/Android.bp | 33 ---------------------------------
 config/common.mk       | 19 +++++++++----------
 2 files changed, 9 insertions(+), 43 deletions(-)

diff --git a/build/soong/Android.bp b/build/soong/Android.bp
index d52e5d64..9670a2e0 100644
--- a/build/soong/Android.bp
+++ b/build/soong/Android.bp
@@ -17,39 +17,6 @@ bootstrap_go_package {
     pluginFor: ["soong_build"],
 }
 
-lineage_generator {
-    name: "generated_kernel_includes",
-
-    // The headers make command
-    cmd: "$(PATH_OVERRIDE_SOONG) $(KERNEL_MAKE_CMD) $(KERNEL_MAKE_FLAGS) -C $(TARGET_KERNEL_SOURCE) O=$(KERNEL_BUILD_OUT_PREFIX)$(genDir) ARCH=$(KERNEL_ARCH) $(KERNEL_CROSS_COMPILE) headers_install",
-
-    // Directories that can be imported by a cc_* module generated_headers property
-    export_include_dirs: [
-        "usr/audio/include/uapi",
-        "usr/include",
-        "usr/include/audio",
-        "usr/include/audio/include/uapi",
-        "usr/techpack/audio/include",
-    ],
-
-    // Sources for dependency tracking
-    dep_root: "$(TARGET_KERNEL_SOURCE)",
-    dep_files: [
-        "Makefile",
-        "include/**/*",
-        "arch/$(KERNEL_ARCH)/include/**/*",
-        "techpack/audio/include/**/*",
-    ],
-}
-
-cc_library_headers {
-    name: "generated_kernel_headers",
-    generated_headers: ["generated_kernel_includes"],
-    export_generated_headers: ["generated_kernel_includes"],
-    vendor_available: true,
-    recovery_available: true,
-}
-
 // Target platform agnostic config modules
 soong_config_module_type {
     name: "disable_postrender_cleanup",
diff --git a/config/common.mk b/config/common.mk
index 6980e9e7..e4a0d4d9 100644
--- a/config/common.mk
+++ b/config/common.mk
@@ -16,21 +16,20 @@ PRODUCT_SYSTEM_DEFAULT_PROPERTIES += \
     ro.com.google.clientidbase=$(PRODUCT_GMS_CLIENTID_BASE)
 endif
 
-ifeq ($(TARGET_BUILD_VARIANT),eng)
+#ifeq ($(TARGET_BUILD_VARIANT),eng)
 # Disable ADB authentication
-PRODUCT_SYSTEM_DEFAULT_PROPERTIES += ro.adb.secure=0
-else
+#PRODUCT_SYSTEM_DEFAULT_PROPERTIES += ro.adb.secure=0
+#else
 # Enable ADB authentication
-PRODUCT_SYSTEM_DEFAULT_PROPERTIES += ro.adb.secure=1
+#PRODUCT_SYSTEM_DEFAULT_PROPERTIES += ro.adb.secure=1
 
 # Disable extra StrictMode features on all non-engineering builds
 PRODUCT_SYSTEM_DEFAULT_PROPERTIES += persist.sys.strictmode.disable=true
-endif
+#endif
 
 # Test Build Tag
 ifeq ($(CIPHER_TEST),true)
     CIPHER_BUILD := DEVELOPER
-    PRODUCT_SYSTEM_DEFAULT_PROPERTIES += ro.adb.secure=0
 endif
 
 # Backup Tool
@@ -134,7 +133,9 @@ PRODUCT_PACKAGES += \
 
 # GameMode
 PRODUCT_PACKAGES += \
-    GameSpace
+    GameSpace \
+    CipherShades \
+    CipherWidget
     
 # Lineage packages
 PRODUCT_PACKAGES += \
@@ -268,9 +269,7 @@ ifeq ($(CIPHER_OFFICIAL), true)
    # $(call inherit-product, vendor/apps/apps.mk)
     CIPHER_BUILD := OFFICIAL
     PRODUCT_PACKAGES += \
-    Updater \
-    CipherShades \
-    CipherWidget
+    Updater
 endif
 
 PRODUCT_SYSTEM_DEFAULT_PROPERTIES += \
-- 
2.37.3

